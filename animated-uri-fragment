<html>
    <script>
        String.prototype.replaceAt = function(index, replacement) {
            return this.substr(0, index) + replacement + this.substr(index + replacement.length);
        }

        window.tick = {};
        window.tick.number = 0
        window.tick.fullText = "Testing...";
        window.tick.currentText = null;
        window.tick.intervalId = null;
        window.tick.mode = "space"; //Options: simple, space

        function tickSpace() {
            console.log(window.tick);
            var index = window.tick.number;
            
            if(index == tick.fullText.length) {
                    window.location.hash = window.tick.fullText;

                    clearInterval(tick.intervalId);
                    return;
            }

            if(window.tick.currentText == null) {
                //initialise tick text state
                console.log("Setting currenttext");
                window.tick.currentText = window.tick.fullText;
                
            } else {
                //Fix up previous character
                window.tick.currentText = window.tick.currentText.replaceAt(index-1,window.tick.fullText[index-1]);
                if(window.tick.currentText == window.tick.fullText) {
                    // console.log("Ending space loop");
                    // clearInterval(tick.intervalId);
                }
            }

            //Set current char as _
            console.log(index);
            window.tick.currentText = window.tick.currentText.replaceAt(index,"_");
            console.log(window.tick.currentText);
//            var new_character = window.tick.fullText[window.tick.number];
            
            window.location.hash = window.tick.currentText;
            console.log()
            window.tick.number++;
        }

        function tickSimple() {
            if(window.tick.currentText == null) {
                //initialise tick text state
                window.tick.currentText = "";
            }

            var new_character = window.tick.fullText[window.tick.number];
            
            if(new_character == undefined) {
                //console.log("End of string appears to have been reached, clearing interval.");
                //clearInterval(window.tick.intervalId);
                window.tick.currentText = "";
                window.tick.number = -1;
            } else {
                if(new_character != "#") {
                    window.tick.currentText += new_character;
                }
            }
            window.location.hash = window.tick.currentText;
            window.tick.number++;
        }

        function tickFunc() {
            if(window.tick.mode == "simple") {
                tickSimple();
            }
            if(window.tick.mode == "space") {
                console.log("SPACE");
                tickSpace();
            }
        }

        window.tick.intervalId = setInterval(()=>{
            //console.log(`tick ${window.tick.number}\n\t${window.tick.currentText}`);
            tickFunc();
        },80);
    </script>
    <body>
    </body>
</html>
